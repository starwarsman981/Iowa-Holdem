<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Iowa Hold'em</title>
  <style>
    body { font-family: monospace; background: #121212; color: #eee; margin: 0; padding: 10px; }
    #players { display: flex; flex-wrap: wrap; gap: 10px; }
    .player { border: 1px solid #555; padding: 5px; width: 200px; background: #222; position: relative; }
    .player.folded { opacity: 0.5; }
    .player.you { border-color: yellow; }
    .cards { display: flex; gap: 4px; margin-top: 5px; }
    .card {
      width: 30px; height: 40px; border: 1px solid #888; border-radius: 4px;
      display: flex; justify-content: center; align-items: center; cursor: default;
      user-select: none; background: #333;
    }
    .card.red { color: red; }
    .card.selected { border-color: yellow; background: #444; cursor: pointer; }
    #community { margin: 10px 0; }
    #community .card { width: 40px; height: 60px; }
    button:disabled { opacity: 0.4; cursor: not-allowed; }
    #actions { margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Iowa Hold'em</h2>
  <div>
    <label>Name: <input type="text" id="nameInput" /></label>
    <button id="joinBtn">Join Game</button>
  </div>
  <div id="status" style="margin-top:10px;"></div>
  <div id="pot" style="margin-top:5px;"></div>
  <div id="phase" style="margin-top:5px;"></div>

  <div id="community"></div>
  <div id="players"></div>

  <div id="actions" style="margin-top:10px; display:none;">
    <button id="foldBtn">Fold</button>
    <button id="checkBtn">Check</button>
    <button id="callBtn">Call</button>
    <input type="number" id="raiseAmount" min="1" style="width:60px;" />
    <button id="raiseBtn">Raise</button>
    <button id="discardBtn" disabled>Discard Selected Card</button>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const ROOM = 'iowa-room';

    const nameInput = document.getElementById('nameInput');
    const joinBtn = document.getElementById('joinBtn');
    const statusDiv = document.getElementById('status');
    const potDiv = document.getElementById('pot');
    const phaseDiv = document.getElementById('phase');
    const communityDiv = document.getElementById('community');
    const playersDiv = document.getElementById('players');
    const actionsDiv = document.getElementById('actions');
    const foldBtn = document.getElementById('foldBtn');
    const checkBtn = document.getElementById('checkBtn');
    const callBtn = document.getElementById('callBtn');
    const raiseBtn = document.getElementById('raiseBtn');
    const raiseAmountInput = document.getElementById('raiseAmount');
    const discardBtn = document.getElementById('discardBtn');

    let myId = null;
    let phase = null;
    let currentTurnId = null;
    let selectedDiscardIndex = null;

    joinBtn.onclick = () => {
      const name = nameInput.value.trim();
      if (!name) return alert('Enter a name');
      socket.emit('joinRoom', { name });
      joinBtn.disabled = true;
      nameInput.disabled = true;
    };

    socket.on('connect', () => {
      myId = socket.id;
    });

    socket.on('status', msg => {
      statusDiv.textContent = msg;
    });

    socket.on('errorMessage', msg => {
      alert(msg);
    });

    socket.on('roomFull', () => {
      alert('Room full, try again later.');
    });

    socket.on('gameState', (state) => {
      phase = state.phase;
      currentTurnId = state.turnId;

      potDiv.textContent = `Pot: ${state.pot} chips`;
      phaseDiv.textContent = `Phase: ${phase.replace(/-/g, ' ')}`;

      // Community cards
      communityDiv.innerHTML = '';
      for (const card of state.community) {
        communityDiv.appendChild(renderCard(card));
      }

      // Players
      playersDiv.innerHTML = '';
      for (const p of state.players) {
        const pDiv = document.createElement('div');
        pDiv.className = 'player';
        if (p.folded) pDiv.classList.add('folded');
        if (p.id === myId) pDiv.classList.add('you');

        let title = `${p.name} - Chips: ${p.chips} - Bet: ${p.bet}`;
        if (p.isDealer
